@page "/company"
@using BoilerPlate.Models
@using BoilerPlate.Services
@inject TicketService Tickets
@inject NavigationManager Nav

<div class="container py-5">
    <h3 class="text-center mb-4">All Submitted Tickets</h3>

    @foreach(var t in Tickets.GetAll())
    {
        <div class="card mb-2 p-3 d-flex justify-content-between align-items-center">
            <div>
                <strong>@t.Username</strong> &mdash;
                <span><strong>Link:</strong> @t.LinkId</span>
                <div class="mt-1">@t.Content</div>
            </div>
            <div class="btn-group">
                <span class="badge @(Badge(t.Status)) me-2">@t.Status</span>
                <button class="btn btn-sm btn-outline-warning"
                        @onclick="() => Change(t.Id, TicketStatus.InProgress)">
                    Handle
                </button>
                <button class="btn btn-sm btn-outline-success"
                        @onclick="() => Change(t.Id, TicketStatus.Resolved)">
                    Resolve
                </button>
            </div>
        </div>
    }

    <div class="text-center mt-4">
        <button class="btn btn-link btn-lg"
                @onclick="() => Nav.NavigateTo("/users")">
            ← Back to Users
        </button>
    </div>
</div>

@code {
    string Badge(TicketStatus s) =>
        s == TicketStatus.InProgress ? "bg-warning" :
        s == TicketStatus.Resolved   ? "bg-success" : "bg-secondary";

    void Change(int id, TicketStatus s) => Tickets.UpdateStatus(id, s);
}